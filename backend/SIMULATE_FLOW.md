# 記事生成フロー シミュレーター

「記事を生成」ボタンを押した場合の流れを模擬するスクリプトです。

## 使用方法

### 1. 基本的なシミュレーション（モック版）

実際のAPIやデータベースを使用せず、コードの流れを追跡します。

```bash
cd backend
python simulate_article_creation.py
```

### 2. 実行結果の例

スクリプトを実行すると、以下のような流れが表示されます：

```
================================================================================
[ステップ 1] フロントエンド: ボタンクリック
時刻: 2025-01-28 12:00:00.000
メッセージ: ユーザーが「記事を生成」ボタンをクリック
データ: {
  "component": "ArticleNew.tsx",
  "action": "handleSubmit",
  "form_data": {
    "keyword": "Python入門",
    "target": "初心者",
    "article_type": "チュートリアル"
  }
}
================================================================================
```

## シミュレーションされる流れ

1. **フロントエンド: ボタンクリック** - ユーザーが「記事を生成」ボタンをクリック
2. **フロントエンド: API呼び出し** - `createMutation.mutate()` が実行される
3. **バックエンド: エンドポイント受信** - `create_article_endpoint()` が呼び出される
4. **バックエンド: 記事レコード作成** - `create_article()` で記事を作成（status="keyword_analysis"）
5. **バックエンド: ステータス確認** - statusが正しく設定されているか確認
6. **バックエンド: 初期進捗状況設定** - `keyword_analysis_progress` を初期化
7. **バックエンド: 記事履歴記録** - 記事作成履歴を記録
8. **バックエンド: キーワード分析タスク開始** - `analyze_keywords_task()` を別スレッドで開始
9. **バックエンド: レスポンス返却** - 記事オブジェクトを返却
10. **フロントエンド: リダイレクト** - `/articles/{id}/keywords` にリダイレクト
11. **バックグラウンド: キーワード分析タスク実行** - キーワード分析を実行
12. **フロントエンド: キーワード選択画面** - キーワード選択画面が表示される
13. **フロントエンド: キーワード選択** - ユーザーがキーワードを選択
14. **バックエンド: キーワード選択処理** - `select_keywords_endpoint()` が実行される
15. **バックグラウンド: 記事生成タスク開始** - `generate_article_task()` が実行される
16. **フロントエンド: 記事詳細ページ** - 記事詳細ページにリダイレクト
17. **バックグラウンド: 記事生成完了** - statusを"completed"に更新
18. **フロントエンド: 記事表示** - 生成された記事が表示される

## 各ステップの詳細

各ステップでは以下の情報が表示されます：

- **ステップ番号**: 処理の順序
- **時刻**: 処理が実行される時刻（シミュレーション）
- **メッセージ**: そのステップで何が起こるか
- **データ**: 関連するファイル、関数、パラメータなどの情報

## 実際のコードとの対応

シミュレーターで表示される各ステップは、実際のコードの以下のファイルに対応しています：

- **フロントエンド**: `frontend/src/pages/ArticleNew.tsx`
- **フロントエンド**: `frontend/src/pages/KeywordSelection.tsx`
- **フロントエンド**: `frontend/src/pages/ArticleDetail.tsx`
- **バックエンド**: `backend/app/routers/articles.py`
- **バックエンド**: `backend/app/tasks.py`
- **バックエンド**: `backend/app/supabase_db.py`

## 注意事項

- このスクリプトは実際のAPIやデータベースを使用しません
- 実際の処理時間は表示されません（シミュレーション用の短い待機時間のみ）
- エラーハンドリングは表示されません（正常系のみ）

## トラブルシューティング

### モジュールが見つからないエラー

```bash
# プロジェクトルートから実行
cd /path/to/project
python backend/simulate_article_creation.py
```

### Pythonのバージョン

Python 3.8以上が必要です。

```bash
python --version
```

